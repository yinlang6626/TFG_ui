<!DOCTYPE html>
<html lang="zh" class="futuristic-theme">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¨¡å‹è®­ç»ƒ | SYNCTALK AI</title>
    
    <link rel="stylesheet" href="{{ url_for('static', filename='css/system.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/components.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/layout.css') }}">

    <!-- JavaScriptæ¨¡å— -->
    <script src="{{ url_for('static', filename='js/modules/theme-manager.js') }}"></script>
    
    <style>
        .training-container {
            min-height: 100vh;
            padding: var(--space-4);
        }
        
        .training-header {
            margin-bottom: var(--space-6);
            text-align: center;
        }
        
        .training-title {
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--neon-blue), var(--neon-purple));
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: var(--space-2);
        }
        
        .training-subtitle {
            color: var(--text-secondary);
            font-size: 1.125rem;
        }
        
        .training-layout {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: var(--space-6);
        }
        
        @media (max-width: 1024px) {
            .training-layout {
                grid-template-columns: 1fr;
            }
        }
        
        .training-form-section {
            background: var(--surface-primary);
            border: var(--border-neon);
            border-radius: var(--radius-xl);
            padding: var(--space-6);
        }
        
        .form-section-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: var(--space-4);
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--space-4);
            margin-bottom: var(--space-4);
        }
        
        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
        }
        
        .form-field {
            margin-bottom: var(--space-3);
        }
        
        .field-label {
            display: block;
            margin-bottom: var(--space-2);
            color: var(--text-primary);
            font-weight: 500;
            font-size: 0.9375rem;
        }
        
        .field-hint {
            display: block;
            margin-top: var(--space-1);
            color: var(--text-secondary);
            font-size: 0.8125rem;
        }
        
        .epoch-control {
            display: flex;
            align-items: center;
            gap: var(--space-3);
        }
        
        .epoch-value {
            min-width: 60px;
            text-align: center;
            font-weight: 600;
            color: var(--neon-blue);
        }
        
        .training-controls {
            display: flex;
            gap: var(--space-3);
            margin-top: var(--space-6);
        }
        
        .training-status-section {
            background: var(--surface-primary);
            border: var(--border-neon);
            border-radius: var(--radius-xl);
            padding: var(--space-6);
            position: sticky;
            top: var(--space-4);
        }
        
        .status-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: var(--space-4);
        }
        
        .status-indicator {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            font-size: 0.875rem;
            font-weight: 500;
        }
        
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--neon-green);
            animation: status-pulse 2s infinite;
        }
        
        @keyframes status-pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }
        
        .training-timer {
            font-size: 2rem;
            font-weight: 700;
            text-align: center;
            margin: var(--space-4) 0;
            font-family: 'Consolas', monospace;
            color: var(--neon-blue);
        }
        
        .metrics-grid {
            display: grid;
            gap: var(--space-3);
            margin-bottom: var(--space-4);
        }
        
        .metric-card {
            background: var(--surface-secondary);
            border-radius: var(--radius-md);
            padding: var(--space-3);
            border-left: 3px solid var(--neon-blue);
        }
        
        .metric-label {
            color: var(--text-secondary);
            font-size: 0.8125rem;
            margin-bottom: var(--space-1);
        }
        
        .metric-value {
            color: var(--text-primary);
            font-size: 1.125rem;
            font-weight: 600;
        }
        
        .training-log {
            background: var(--surface-secondary);
            border: 1px solid rgba(0, 243, 255, 0.1);
            border-radius: var(--radius-md);
            padding: var(--space-3);
            max-height: 200px;
            overflow-y: auto;
            font-family: 'Consolas', monospace;
            font-size: 0.8125rem;
            line-height: 1.4;
        }

        /* ç¾åŒ–æ»šåŠ¨æ¡ */
        .training-log::-webkit-scrollbar {
            width: 6px;
        }

        .training-log::-webkit-scrollbar-track {
            background: rgba(0, 243, 255, 0.05);
            border-radius: 3px;
        }

        .training-log::-webkit-scrollbar-thumb {
            background: rgba(0, 243, 255, 0.3);
            border-radius: 3px;
        }

        .training-log::-webkit-scrollbar-thumb:hover {
            background: rgba(0, 243, 255, 0.5);
        }
        
        .log-entry {
            margin-bottom: var(--space-1);
            color: var(--text-secondary);
        }
        
        .log-entry.info {
            color: var(--neon-blue);
        }
        
        .log-entry.warning {
            color: var(--neon-pink);
        }
        
        .log-entry.success {
            color: var(--neon-green);
        }
    </style>
</head>
<body>
    <!-- å¯¼èˆªæ  -->
    <nav class="neon-navbar">
        <a href="/" class="nav-brand">
            <span>SYNCTALK</span>
        </a>
        <ul class="nav-menu">
            <li><a href="/model_training" class="nav-link active">è®­ç»ƒæ¨¡å‹</a></li>
            <li><a href="/video_generation" class="nav-link">è§†é¢‘ç”Ÿæˆ</a></li>
            <li><a href="/audio_clone" class="nav-link">éŸ³é¢‘å…‹éš†</a></li>
            <li><a href="/chat_system" class="nav-link">äººæœºå¯¹è¯</a></li>
        </ul>
        <!-- ä¸»é¢˜åˆ‡æ¢å™¨ -->
        <button class="theme-toggle navbar-theme-toggle" data-theme-toggle aria-label="åˆ‡æ¢ä¸»é¢˜">
            <span class="theme-icon sun">
                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <circle cx="12" cy="12" r="5" stroke="currentColor" stroke-width="2"/>
                    <path d="M12 1v6M12 17v6M4.22 4.22l4.24 4.24M15.54 15.54l4.24 4.24M1 12h6M17 12h6M4.22 19.78l4.24-4.24M15.54 8.46l4.24-4.24" stroke-width="2" stroke-linecap="round"/>
                </svg>
            </span>
            <span class="theme-icon moon">
                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" stroke="currentColor" stroke-width="2"/>
                </svg>
            </span>
            <span class="theme-tooltip">åˆ‡æ¢ä¸»é¢˜</span>
        </button>
    </nav>

    <div class="training-container">
        <div class="training-header">
            <h1 class="training-title">æ™ºèƒ½æ¨¡å‹è®­ç»ƒ</h1>
            <p class="training-subtitle">åŸºäºæ·±åº¦å­¦ä¹ çš„ä¸ªæ€§åŒ–æ¨¡å‹è®­ç»ƒç³»ç»Ÿ</p>
        </div>
        
        <div class="training-layout">
            <!-- è®­ç»ƒé…ç½®åŒºåŸŸ -->
            <div class="training-form-section floating-card">
                <h2 class="form-section-title">
                    <span>è®­ç»ƒé…ç½®</span>
                </h2>
                
                <form id="trainingForm">
                    <div class="form-grid">
                        <div class="form-field">
                            <label class="field-label">æ¨¡å‹é€‰æ‹©</label>
                            <select class="neon-input" name="model_choice" style="min-width: 120px;">
                                <option value="SyncTalk">SyncTalk</option>
                                <option value="ER_NeRF">ER_NeRF</option>
                            </select>
                        </div>

                        <div class="form-field">
                            <label class="field-label">å‚è€ƒè§†é¢‘</label>
                            <div style="display: flex; gap: var(--space-2); align-items: stretch;">
                                <select class="neon-input" name="ref_video" id="refVideoSelect" style="flex: 1; min-width: 200px;">
                                    <option value="">è¯·é€‰æ‹©å‚è€ƒè§†é¢‘...</option>
                                </select>
                                <button type="button" class="neon-btn neon-btn-sm" id="refreshVideosBtn" title="åˆ·æ–°è§†é¢‘åˆ—è¡¨" style="flex-shrink: 0; min-width: 80px;">
                                    åˆ·æ–°
                                </button>
                            </div>
                            <div style="margin-top: var(--space-2); display: flex; gap: var(--space-2); align-items: center;">
                                <input type="file" class="neon-input" id="videoUploadInput" accept=".mp4,.avi,.mov,.mkv,.flv,.webm" style="display: none;">
                                <button type="button" class="neon-btn neon-btn-sm" id="uploadVideoBtn" style="flex-shrink: 0;">
                                    ä¸Šä¼ è§†é¢‘
                                </button>
                                <span class="field-hint" id="uploadStatus" style="font-size: 0.75rem; margin: 0; flex: 1;"></span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-grid">
                        <div class="form-field">
                            <label class="field-label">GPU é€‰æ‹©</label>
                            <select class="neon-input" name="gpu_choice">
                                <option value="GPU0">GPU 0</option>
                                <option value="GPU1">GPU 1</option>
                                <option value="GPU2">GPU 2</option>
                                <option value="CPU">CPU æ¨¡å¼</option>
                            </select>
                        </div>
                        
                        <div class="form-field">
                            <label class="field-label">
                                è®­ç»ƒè½®æ•° (Epoch)
                                <span class="field-hint">å»ºè®®å€¼: 50-200</span>
                            </label>
                            <div class="epoch-control">
                                <input type="range"
                                       class="epoch-slider neon-input"
                                       min="10"
                                       max="500"
                                       value="100"
                                       name="epoch"
                                       id="epochSlider">
                                <span class="epoch-value" id="epochValue">100</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-field">
                        <label class="field-label">è‡ªå®šä¹‰è®­ç»ƒå‚æ•°</label>
                        <textarea
                            class="custom-params-area neon-input"
                            placeholder="è¯·è¾“å…¥è‡ªå®šä¹‰å‚æ•°ï¼Œæ¯è¡Œä¸€ä¸ªï¼Œæ ¼å¼ï¼šå‚æ•°å=å€¼"
                            name="custom_params"></textarea>
                    </div>
                    
                    <div class="training-controls">
                        <button type="submit" class="neon-btn neon-btn-glow" id="startTrainingBtn">
                            å¼€å§‹è®­ç»ƒ
                        </button>
                        <button type="button" class="neon-btn" id="stopTrainingBtn" disabled>
                            åœæ­¢è®­ç»ƒ
                        </button>
                        <button type="button" class="neon-btn" id="resetTrainingBtn">
                            é‡ç½®é…ç½®
                        </button>
                    </div>
                </form>
            </div>
            
            <!-- è®­ç»ƒçŠ¶æ€åŒºåŸŸ -->
            <div class="training-status-section floating-card">
                <div class="status-header">
                    <h3 class="form-section-title" style="margin: 0;">
                        <span>ğŸ“Š è®­ç»ƒçŠ¶æ€</span>
                    </h3>
                    <div class="status-indicator" id="statusIndicator">
                        <div class="status-dot"></div>
                        <span id="statusText">ç­‰å¾…å¼€å§‹</span>
                    </div>
                </div>
                
                <div class="training-timer" id="trainingTimer">00:00:00</div>
                
                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-label">å½“å‰è½®æ¬¡</div>
                        <div class="metric-value" id="currentEpoch">0/100</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">æŸå¤±å€¼</div>
                        <div class="metric-value" id="lossValue">0.0000</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">è®­ç»ƒé€Ÿåº¦</div>
                        <div class="metric-value" id="trainingSpeed">0 it/s</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">GPU ä½¿ç”¨ç‡</div>
                        <div class="metric-value" id="gpuUsage">0%</div>
                    </div>
                </div>
                
                <div class="form-section-title" style="margin-bottom: var(--space-2);">
                    <span>è®­ç»ƒæ—¥å¿—</span>
                </div>
                <div class="training-log" id="trainingLog">
                    <div class="log-entry info">ç³»ç»Ÿå°±ç»ªï¼Œç­‰å¾…è®­ç»ƒå¼€å§‹...</div>
                    <div class="log-entry info">GPU 0 å¯ç”¨ï¼Œæ˜¾å­˜: 8GB</div>
                    <div class="log-entry info">æ¨¡å‹åŠ è½½å™¨åˆå§‹åŒ–å®Œæˆ</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Epochæ»‘å—åŒæ­¥
        const epochSlider = document.getElementById('epochSlider');
        const epochValue = document.getElementById('epochValue');

        // è§†é¢‘ç®¡ç†åŠŸèƒ½
        const refVideoSelect = document.getElementById('refVideoSelect');
        const refreshVideosBtn = document.getElementById('refreshVideosBtn');
        const uploadVideoBtn = document.getElementById('uploadVideoBtn');
        const videoUploadInput = document.getElementById('videoUploadInput');
        const uploadStatus = document.getElementById('uploadStatus');

        // åŠ è½½è®­ç»ƒè§†é¢‘åˆ—è¡¨
        async function loadTrainingVideos() {
            try {
                const response = await fetch('/api/training-videos');
                const data = await response.json();

                if (data.status === 'success') {
                    // æ¸…ç©ºç°æœ‰é€‰é¡¹
                    refVideoSelect.innerHTML = '<option value="">è¯·é€‰æ‹©å‚è€ƒè§†é¢‘...</option>';

                    // æ·»åŠ è§†é¢‘é€‰é¡¹
                    data.files.forEach(video => {
                        const option = document.createElement('option');
                        option.value = video.relative_path;
                        option.textContent = `${video.filename} (${video.size_mb}MB)`;
                        refVideoSelect.appendChild(option);
                    });

                    console.log(`[UI] åŠ è½½äº† ${data.files.length} ä¸ªè®­ç»ƒè§†é¢‘`);
                } else {
                    console.error('åŠ è½½è§†é¢‘åˆ—è¡¨å¤±è´¥:', data.message);
                }
            } catch (error) {
                console.error('åŠ è½½è§†é¢‘åˆ—è¡¨å‡ºé”™:', error);
                uploadStatus.textContent = 'åŠ è½½å¤±è´¥';
                uploadStatus.style.color = 'var(--neon-pink)';
            }
        }

        // ä¸Šä¼ è§†é¢‘
        async function uploadVideo(file) {
            const formData = new FormData();
            formData.append('video', file);

            try {
                uploadStatus.textContent = 'ä¸Šä¼ ä¸­...';
                uploadStatus.style.color = 'var(--neon-blue)';
                uploadVideoBtn.disabled = true;

                const response = await fetch('/api/upload-training-video', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();

                if (data.status === 'success') {
                    uploadStatus.textContent = 'ä¸Šä¼ æˆåŠŸ';
                    uploadStatus.style.color = 'var(--neon-green)';

                    // åˆ·æ–°è§†é¢‘åˆ—è¡¨
                    await loadTrainingVideos();

                    // é€‰æ‹©åˆšä¸Šä¼ çš„è§†é¢‘
                    refVideoSelect.value = data.relative_path;

                    // æ·»åŠ æˆåŠŸæ—¥å¿—
                    addLogEntry(`è§†é¢‘ä¸Šä¼ æˆåŠŸ: ${data.original_name}`, 'success');

                } else {
                    uploadStatus.textContent = `ä¸Šä¼ å¤±è´¥: ${data.message}`;
                    uploadStatus.style.color = 'var(--neon-pink)';
                    addLogEntry(`è§†é¢‘ä¸Šä¼ å¤±è´¥: ${data.message}`, 'warning');
                }
            } catch (error) {
                console.error('è§†é¢‘ä¸Šä¼ å‡ºé”™:', error);
                uploadStatus.textContent = 'ä¸Šä¼ å¤±è´¥';
                uploadStatus.style.color = 'var(--neon-pink)';
                addLogEntry('è§†é¢‘ä¸Šä¼ å¤±è´¥: ç½‘ç»œé”™è¯¯', 'warning');
            } finally {
                uploadVideoBtn.disabled = false;
                // æ¸…ç©ºæ–‡ä»¶è¾“å…¥
                videoUploadInput.value = '';

                // 3ç§’åæ¸…é™¤çŠ¶æ€
                setTimeout(() => {
                    uploadStatus.textContent = '';
                }, 3000);
            }
        }

        // æ·»åŠ æ—¥å¿—æ¡ç›®
        function addLogEntry(message, type = 'info') {
            const trainingLog = document.getElementById('trainingLog');
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry ${type}`;
            logEntry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            trainingLog.appendChild(logEntry);
            trainingLog.scrollTop = trainingLog.scrollHeight;
        }

        // åˆ·æ–°è§†é¢‘æŒ‰é’®ç‚¹å‡»äº‹ä»¶
        refreshVideosBtn.addEventListener('click', async function() {
            this.disabled = true;
            this.textContent = 'åˆ·æ–°ä¸­...';

            await loadTrainingVideos();

            this.disabled = false;
            this.textContent = 'åˆ·æ–°';
            addLogEntry('è§†é¢‘åˆ—è¡¨å·²åˆ·æ–°', 'info');
        });

        // ä¸Šä¼ è§†é¢‘æŒ‰é’®ç‚¹å‡»äº‹ä»¶
        uploadVideoBtn.addEventListener('click', function() {
            videoUploadInput.click();
        });

        // æ–‡ä»¶é€‰æ‹©å˜åŒ–äº‹ä»¶
        videoUploadInput.addEventListener('change', function() {
            if (this.files && this.files[0]) {
                const file = this.files[0];
                console.log('é€‰æ‹©äº†æ–‡ä»¶:', file.name, file.size, file.type);

                // æ£€æŸ¥æ–‡ä»¶å¤§å° (100MB)
                const maxSize = 100 * 1024 * 1024;
                if (file.size > maxSize) {
                    uploadStatus.textContent = 'æ–‡ä»¶è¿‡å¤§ (æœ€å¤§100MB)';
                    uploadStatus.style.color = 'var(--neon-pink)';
                    this.value = '';
                    return;
                }

                // æ£€æŸ¥æ–‡ä»¶ç±»å‹
                const allowedTypes = ['video/mp4', 'video/avi', 'video/quicktime', 'video/x-matroska', 'video/x-flv', 'video/webm'];
                const fileExt = file.name.toLowerCase().split('.').pop();
                const allowedExts = ['mp4', 'avi', 'mov', 'mkv', 'flv', 'webm'];

                if (!allowedExts.includes(fileExt)) {
                    uploadStatus.textContent = 'ä¸æ”¯æŒçš„è§†é¢‘æ ¼å¼';
                    uploadStatus.style.color = 'var(--neon-pink)';
                    this.value = '';
                    return;
                }

                uploadVideo(file);
            }
        });

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨åŠ è½½è§†é¢‘åˆ—è¡¨
        document.addEventListener('DOMContentLoaded', function() {
            loadTrainingVideos();
        });
        
        epochSlider.addEventListener('input', function() {
            epochValue.textContent = this.value;
        });
        
        // è®­ç»ƒè®¡æ—¶å™¨
        let trainingTimer = null;
        let trainingSeconds = 0;
        
        function startTimer() {
            trainingSeconds = 0;
            trainingTimer = setInterval(() => {
                trainingSeconds++;
                updateTimerDisplay();
            }, 1000);
        }
        
        function stopTimer() {
            clearInterval(trainingTimer);
        }
        
        function updateTimerDisplay() {
            const hours = Math.floor(trainingSeconds / 3600);
            const minutes = Math.floor((trainingSeconds % 3600) / 60);
            const seconds = trainingSeconds % 60;
            
            document.getElementById('trainingTimer').textContent = 
                `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }
        
        // æ¨¡æ‹Ÿè®­ç»ƒè¿‡ç¨‹
        function simulateTraining(epochs) {
            const statusText = document.getElementById('statusText');
            const currentEpoch = document.getElementById('currentEpoch');
            const lossValue = document.getElementById('lossValue');
            const trainingSpeed = document.getElementById('trainingSpeed');
            const gpuUsage = document.getElementById('gpuUsage');
            const trainingLog = document.getElementById('trainingLog');
            const startBtn = document.getElementById('startTrainingBtn');
            const stopBtn = document.getElementById('stopTrainingBtn');
            
            let currentEpochNum = 0;
            let loss = 0.8;
            let isTraining = true;
            
            const trainingInterval = setInterval(() => {
                if (!isTraining || currentEpochNum >= epochs) {
                    clearInterval(trainingInterval);
                    statusText.textContent = 'è®­ç»ƒå®Œæˆ';
                    startBtn.disabled = false;
                    stopBtn.disabled = true;
                    
                    const logEntry = document.createElement('div');
                    logEntry.className = 'log-entry success';
                    logEntry.textContent = `[${new Date().toLocaleTimeString()}] è®­ç»ƒå®Œæˆï¼Œæ€»è®¡ ${epochs} è½®`;
                    trainingLog.appendChild(logEntry);
                    trainingLog.scrollTop = trainingLog.scrollHeight;
                    
                    return;
                }
                
                currentEpochNum++;
                loss = loss * 0.95 + Math.random() * 0.05;
                
                // æ›´æ–°æ˜¾ç¤º
                currentEpoch.textContent = `${currentEpochNum}/${epochs}`;
                lossValue.textContent = loss.toFixed(4);
                trainingSpeed.textContent = `${(Math.random() * 50 + 10).toFixed(1)} it/s`;
                gpuUsage.textContent = `${Math.floor(Math.random() * 30 + 70)}%`;
                
                // æ·»åŠ æ—¥å¿—
                if (currentEpochNum % 10 === 0) {
                    const logEntry = document.createElement('div');
                    logEntry.className = 'log-entry info';
                    logEntry.textContent = `[${new Date().toLocaleTimeString()}] Epoch ${currentEpochNum}/${epochs} - Loss: ${loss.toFixed(4)}`;
                    trainingLog.appendChild(logEntry);
                    trainingLog.scrollTop = trainingLog.scrollHeight;
                }
            }, 1000);
            
            // åœæ­¢è®­ç»ƒå‡½æ•°
            window.stopTraining = function() {
                isTraining = false;
                statusText.textContent = 'è®­ç»ƒåœæ­¢';
                stopTimer();
                
                const logEntry = document.createElement('div');
                logEntry.className = 'log-entry warning';
                logEntry.textContent = `[${new Date().toLocaleTimeString()}] è®­ç»ƒè¢«æ‰‹åŠ¨åœæ­¢ï¼Œå½“å‰è½®æ¬¡: ${currentEpochNum}`;
                trainingLog.appendChild(logEntry);
                trainingLog.scrollTop = trainingLog.scrollHeight;
            };
        }
        
        // è¡¨å•æäº¤
        document.getElementById('trainingForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const epochs = parseInt(epochSlider.value);
            const startBtn = document.getElementById('startTrainingBtn');
            const stopBtn = document.getElementById('stopTrainingBtn');
            
            // æ›´æ–°UI
            document.getElementById('statusText').textContent = 'è®­ç»ƒä¸­...';
            startBtn.disabled = true;
            stopBtn.disabled = false;
            
            // å¼€å§‹è®¡æ—¶å™¨
            startTimer();
            
            // æ·»åŠ å¼€å§‹æ—¥å¿—
            const trainingLog = document.getElementById('trainingLog');
            const logEntry = document.createElement('div');
            logEntry.className = 'log-entry success';
            logEntry.textContent = `[${new Date().toLocaleTimeString()}] å¼€å§‹è®­ç»ƒï¼Œæ€»è½®æ¬¡: ${epochs}`;
            trainingLog.appendChild(logEntry);
            trainingLog.scrollTop = trainingLog.scrollHeight;
            
            // å¼€å§‹æ¨¡æ‹Ÿè®­ç»ƒ
            simulateTraining(epochs);
            
            // å®é™…æäº¤åˆ°åç«¯
            fetch('/model_training', {
                method: 'POST',
                body: formData
            }).catch(error => {
                console.error('Error:', error);
            });
        });
        
        // åœæ­¢è®­ç»ƒæŒ‰é’®
        document.getElementById('stopTrainingBtn').addEventListener('click', function() {
            window.stopTraining?.();
            this.disabled = true;
            document.getElementById('startTrainingBtn').disabled = false;
        });
        
        // é‡ç½®é…ç½®æŒ‰é’®
        document.getElementById('resetTrainingBtn').addEventListener('click', function() {
            document.getElementById('trainingForm').reset();
            epochSlider.value = 100;
            epochValue.textContent = '100';
            document.getElementById('statusText').textContent = 'ç­‰å¾…å¼€å§‹';
            document.getElementById('trainingTimer').textContent = '00:00:00';
            document.getElementById('trainingLog').innerHTML = `
                <div class="log-entry info">ç³»ç»Ÿå°±ç»ªï¼Œç­‰å¾…è®­ç»ƒå¼€å§‹...</div>
                <div class="log-entry info">GPU 0 å¯ç”¨ï¼Œæ˜¾å­˜: 8GB</div>
                <div class="log-entry info">æ¨¡å‹åŠ è½½å™¨åˆå§‹åŒ–å®Œæˆ</div>
            `;
        });
    </script>
</body>
</html>